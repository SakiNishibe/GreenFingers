<%= render partial: 'layouts/header' %>
<div class="container-fluid container-main">
  <div class="row">
    <% if user_signed_in? %>
  	<%= render partial: 'layouts/sidebar', user: @user %>
    <% end %>
  	<div class="col col-md-10 col-body">

  	<%= render partial: 'layouts/flash' %>

  	<div>
      <%= attachment_image_tag(@topic, :eyecatch_img, fallback: 'no_img.jpg', size: '200x200') %>
      <% if user_signed_in? && @topic.user_id == current_user.id %>
      <span id="status_btn-<%= @topic.id %>">
        <%= render 'topics/status_btn', topic: @topic %>
      </span>
      <%= link_to 'タイトルを変更', edit_topic_path(@topic.id), class: 'btn-green' %>
      <%= link_to '削除', topic_path(@topic.id), data: {confirm: 'トピックを削除しますか？'},  method: :delete, class: 'btn-crud-red', id: 'delete_topic' %>
      <% end %>
      <h3><%= @topic.title %></h3>
      <h5>カテゴリ：<%= render 'topics/category', category: @topic.category %>、<%= simple_time(@topic[:updated_at]) %></h5>
      <div id="comments_for_topic-<%= @topic.id %>" style="padding-top: 30px;">
      </style>
        <%= render 'topic_comments/tc_index', topic_comments: @topic_comments %>
      </div>
  	</div>

    <% if user_signed_in? %>
    <div class="topic_comment_form" style="padding-top: 50px;">
      <%= form_with(model: @topic_comment, url: topic_topic_comments_path(@topic), remote: true) do |f| %>
        <h4>新規コメント</h4><br>
        <%= link_to user_path(@user) do %>
          <%= attachment_image_tag(current_user, :profile_img, fallback: 'no_img.jpg', size: '50x50') %>
        <% end %>
        <%= current_user.name %>
        <%= f.attachment_field :image %>
        <%= f.text_area :comment, placeholder: '最大500文字', class: 'form-control', id: 'topic_comment_text' %><br>
        <%= f.submit '送信！', class: 'btn-brown offset-11' %>
      <% end %>
    </div>
    <% end %>

    </div>
  </div>
</div>
